docktor:
  build: docker-docktor
  hostname: docktor
  links:
    - mongodb:db_1
  ports:
    - "3000:3000"

mongodb:
  build: docker-mongodb
  hostname: docktor-mongodb
  volumes:
   - /docktor/data_docktor/mongodb/data:/data
   - /docktor/data_docktor/mongodb/opt/backups:/opt/backups

influxdb:
  build: docker-influxdb
  hostname: docktor-influxdb
  ports:
   - "8086:8086"
   - "8083:8083"
  # Bug with mapping volume of influxdb on vagrant :
  #[2014/12/20 15:15:39 UTC] [EROR] (github.com/influxdb/influxdb/cluster.(*ClusterConfiguration).AddShards:1075) AddShards: error setting local store: %!(EXTRA levigo.DatabaseError=IO error: /data/db/shard_db_v2/00194: Invalid argument)
  #[2014/12/20 15:15:39 UTC] [EROR] (github.com/influxdb/influxdb/coordinator.(*RaftServer).doOrProxyCommandOnce:168) Cannot run command &coordinator.CreateShardsCommand{Shards:[]*cluster.NewShardData{(*cluster.NewShardData)(0xc2082cc8c0)}, SpaceName:""}. IO error: /data/db/shard_db_v2/00194: Invalid argument
  #[2014/12/20 15:15:39 UTC] [EROR] (github.com/influxdb/influxdb/coordinator.(*RaftServer).CreateShards:750) RAFT: CreateShards: %!(EXTRA levigo.DatabaseError=IO error: /data/db/shard_db_v2/00194: Invalid argument)
  # volumes:
  #- /docktor/data_docktor/influxdb/data:/data

grafana:
  build: docker-grafana
  hostname: docktor-grafana
  environment:
    INFLUXDB_PROTOCOL : http
    INFLUXDB_HOST : 192.168.50.4
    INFLUXDB_PORT : 8086
    INFLUXDB_NAME : riemann
    INFLUXDB_USER : root
    INFLUXDB_PASS : root
    HTTP_USER : admin
    HTTP_PASS : admin
  ports:
   - "8090:80"
  volumes:
   - /docktor/data_docktor/grafana/opt/app/app/dashboards:/opt/app/app/dashboards

riemann:
  build: docker-riemann
  hostname: docktor-riemann
  environment:
    RIEMANN_DASH_CONFIG_PORT: 4567
    RIEMANN_DASH_WS_PORT: 5556
    RIEMANN_HOST: 192.168.50.4
    RIEMANN_INFLUXDB_HOST: 192.168.50.4
    RIEMANN_INFLUXDB_PORT: 8086
    RIEMANN_INFLUXDB_USERNAME: root
    RIEMANN_INFLUXDB_PASSWORD: root
    RIEMANN_INFLUXDB_DB: riemann
  ports:
   - "4567:4567"
   - "5555:5555/tcp"
   - "5555:5555/udp"
   - "5556:5556"
  volumes:
   - /docktor/data_docktor/riemann/opt/riemann/riemann/etc:/opt/riemann/riemann/etc

gorycadvisor:
  build: docker-goryCadvisor
  hostname: docktor-goryCadvisor
  environment:
    RIEMANN_ADDRESS: 192.168.50.4:5555
    CADVISOR_ADDRESS: 192.168.50.4:8080
    INTERVAL: 20s
    RIEMANN_TTL_EVENT: 30
    RIEMANN_HOST_EVENT: MY_HOST

cadvisor:
  image: google/cadvisor:latest
  volumes:
   - /:/rootfs:ro
   - /var/run:/var/run:rw
   - /sys:/sys:ro
   - /var/lib/docker/:/var/lib/docker:ro
  ports:
   - "8080:8080"

